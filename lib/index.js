"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==l.return||l.return()}finally{if(a)throw i}}return r}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var Dep=function(){function e(){_classCallCheck(this,e),this.subs=[]}return _createClass(e,[{key:"addSub",value:function(e){this.subs.push(e)}},{key:"notify",value:function(){this.subs.forEach(function(e){e.update()})}}]),e}();_defineProperty(Dep,"target",void 0),Dep.target=null;var targetStack=[];function pushTarget(e){targetStack.push(Dep.target),Dep.target=e}function popTarget(){targetStack.pop(),Dep.target=targetStack[targetStack.length-1]}var Watcher=function(){function n(e,t,r){_classCallCheck(this,n),this.vm=e,this.expr=t,this.cb=r,this.oldVal=this.getOldValue()}return _createClass(n,[{key:"getOldValue",value:function(){pushTarget(this);var e=compileUtil.filterExpr(this.expr,this.vm);return popTarget(),e}},{key:"update",value:function(){var e=compileUtil.filterExpr(this.expr,this.vm);e!==this.oldVal&&this.cb(e)}}]),n}(),compileUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getValue",value:function(e,t){return e.split(".").reduce(function(e,t){return e[t]},t.$data)}},{key:"setValue",value:function(e,t,r){e.split(",").reduce(function(e,t){e[t]=r},t.$data)}},{key:"filterExpr",value:function(e,t){var r=this;return/\{\{(.+?)\}\}/g.test(e)?e.replace(/\{\{(.+?)\}\}/g,function(){return r.getValue(arguments.length<=1?void 0:arguments[1],t)}):this.getValue(e,t)}},{key:"text",value:function(t,e,r){var n=this,a=this.filterExpr(e,r);new Watcher(r,e,function(e){console.log(e),n.textUpdater(t,e)}),this.textUpdater(t,a)}},{key:"html",value:function(t,e,r){var n=this,a=this.getValue(e,r);new Watcher(r,e,function(e){n.htmlUpdater(t,e)}),this.htmlUpdater(t,a)}},{key:"model",value:function(t,r,n){var a=this,e=this.getValue(r,n);new Watcher(n,r,function(e){a.modelUpdater(t,e)}),t.addEventListener("input",function(e){var t=e.target.value;console.log(t),a.setValue(r,n,t)}),this.modelUpdater(t,e)}},{key:"on",value:function(e,t,r,n){var a,i=this,o=r.$options.methods;if(/\((.+?)\)/g.test(t)){var l,u=_slicedToArray(t.match(/(\w+)\((.+?)\)/),3),s=u[1],c=u[2].split(",").map(function(e){return i.getValue(e,r)});a=(l=o[s]).bind.apply(l,[r].concat(_toConsumableArray(c)))}else a=o[t].bind(r);e.addEventListener(n,a,!1)}},{key:"modelUpdater",value:function(e,t){e.value=t}},{key:"textUpdater",value:function(e,t){e.textContent=t}},{key:"htmlUpdater",value:function(e,t){e.innerHTML=t}}]),e}(),Compiler=function(){function n(e,t){_classCallCheck(this,n),this.el=this.isNode(e)?e:document.querySelector("".concat(e)),this.vm=t;var r=this.nodeToFragment(this.el);this.compile(r),this.el.appendChild(r)}return _createClass(n,[{key:"compile",value:function(e){var t=this;_toConsumableArray(e.childNodes).forEach(function(e){t.isNode(e)?t.compileElement(e):t.compileText(e),e.childNodes&&e.childNodes.length&&t.compile(e)})}},{key:"compileElement",value:function(u){var s=this;_toConsumableArray(u.attributes).forEach(function(e){var t=e.name,r=e.value;if(s.isDirective(t)){var n=_slicedToArray(t.split("-"),2)[1],a=_slicedToArray(n.split(":"),2),i=a[0],o=a[1];compileUtil[i](u,r,s.vm,o),u.removeAttribute("v-".concat(n))}else if(s.isAtEventName(t)){var l=_slicedToArray(t.split("@"),2)[1];compileUtil.on(u,r,s.vm,l)}})}},{key:"isAtEventName",value:function(e){return e.startsWith("@")}},{key:"isDirective",value:function(e){return e.startsWith("v-")}},{key:"compileText",value:function(e){var t=e.textContent;/\{\{(.+?)\}\}/g.test(t)&&compileUtil.text(e,t,this.vm)}},{key:"nodeToFragment",value:function(e){for(var t,r=document.createDocumentFragment();t=e.firstChild;)r.appendChild(t);return r}},{key:"isNode",value:function(e){return 1===e.nodeType}}]),n}(),Observer=function(){function t(e){_classCallCheck(this,t),this.observe(e)}return _createClass(t,[{key:"observe",value:function(t){var r=this;t&&"object"===_typeof(t)&&Object.keys(t).forEach(function(e){r.defineReactive(t,e,t[e])})}},{key:"defineReactive",value:function(e,t,r){var n=this,a=new Dep;n.observe(r),Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return Dep.target&&a.addSub(Dep.target),r},set:function(e){n.observe(e),e!==r&&(r=e),a.notify()}})}}]),t}(),Vue=function(){function t(e){_classCallCheck(this,t),this.$el=e.el,this.$data=e.data,this.$options=e,this.$el&&(new Observer(this.$data),new Compiler(this.$el,this),this.proxyData())}return _createClass(t,[{key:"proxyData",value:function(){function e(t){Object.defineProperty(r,t,{get:function(){return n[t]},set:function(e){n[t]=e}})}var r=this,n=this.$data;for(var t in n)e(t)}}]),t}();module.exports=Vue;
//# sourceMappingURL=index.js.map
